#!/bin/bash

set -eufo pipefail

{{- if not (lookPath "asdf") }}

echo "Installing asdf..."
ASDF_DIR="${HOME}/.asdf"
[ ! -d $ASDF_DIR ] && git clone https://github.com/asdf-vm/asdf.git "${ASDF_DIR}"

{{- else }}

{{ $file := joinPath .chezmoi.homeDir ".tool-versions" -}}
# asdf tool versions hash: {{ include $file | sha256sum }}

{{- end }}

. ${ASDF_DIR}/asdf.sh
asdf update

set +eufo pipefail
while read -r plugin _; do
    asdf plugin-add "$plugin" || true
done <"${HOME}/.tool-versions"
asdf install
