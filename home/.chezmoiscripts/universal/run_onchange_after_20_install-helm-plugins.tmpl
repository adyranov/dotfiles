{{- if .toolchains.kubernetes -}}
#!/usr/bin/env bash

source $HOME/.config/shell/exports.sh

# {{ includeTemplate "universal/next-update" . }}

declare -A HELM_PLUGINS=(
{{- $packages := splitList " " (includeTemplate "universal/packages" (dict "root" . "packageManager" "helm")) -}}
{{- range $pkg := $packages -}}
{{- if ne $pkg "" }}
  {{- $basename := regexReplaceAll ".*\\/([^/]+?)(\\.git)?$" $pkg "${1}" }}
  {{- $name := regexReplaceAll "^helm-" $basename "" }}
  ["{{ $name }}"]="{{ $pkg }}"
{{- end -}}
{{- end }}
)

for name in "${!HELM_PLUGINS[@]}"; do
    url=${HELM_PLUGINS[$name]}
    if ! helm plugin list | awk '{print $1}' | grep -qx "$name"; then
        echo "Installing Helm plugin $name"
        helm plugin install "$url"
    else
        echo "Helm plugin $name already installed"
    fi
done
{{- end -}}
