{{- $headless := false -}}
{{- $ephemeral := false -}}
{{- $personal := true -}}
{{- $restricted := false -}}
{{- $name := "Artem Dyranov" -}}
{{- $email := "artem.dyranov@gmail.com" -}}

{{/* detect GitHub codespaces, VSCode remote containers, Docker containers, Multipass VMs, and Vagrant boxes */}}
{{- $ephemeralEnvOrUsername := or (env "CODESPACES") (env "REMOTE_CONTAINERS_IPC") (eq .chezmoi.username "root" "ubuntu" "vagrant" "vscode" "devcontainer") -}}
{{- $ephemeralCgroup := and (stat "/proc/1/cgroup") (output "cat" "/proc/1/cgroup" | regexMatch "(docker|lxc)") -}}
{{- if or $ephemeralEnvOrUsername $ephemeralCgroup -}}
{{-   $headless = true -}}
{{-   $ephemeral = true -}}
{{- end -}}

{{- if stdinIsATTY -}}

{{- if hasKey . "personal" -}}
{{-   $personal = .personal -}}
{{- else -}}
{{-   $personal = promptBool "Personal Environment" $personal -}}
{{- end -}}

{{- if hasKey . "restricted" -}}
{{-   $restricted = .restricted -}}
{{- else -}}
{{-   $restricted = promptBool "Restricted Environment (no sudo access)" $restricted -}}
{{- end -}}

{{- if hasKey . "name" -}}
{{-   $name = .name -}}
{{- else -}}
{{-   $name = promptString "Your Name" $name -}}
{{- end -}}

{{- if hasKey . "email" -}}
{{-   $email = .email -}}
{{- else -}}
{{-   $email = promptString "Your Email" $email -}}
{{- end -}}

{{-   writeToStdout "ðŸ’¡ Tip: you can re-enter your name and email with `chezmoi init --data=false`.\n" -}}

{{- else -}}
{{-   $headless = true -}}
{{- end -}}

sourceDir: "{{ .chezmoi.sourceDir }}"

diff:
  pager: "delta"

data:
    email: "{{ $email }}"
    name: "{{ $name }}"
    personal: {{ $personal }}
    restricted: {{ $restricted }}
    headless: {{ $headless }}
    ephemeral: {{ $ephemeral }}
